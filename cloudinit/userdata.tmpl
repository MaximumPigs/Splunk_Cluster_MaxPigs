#cloud-config

package_update: true

packages: ['snapd']

fqdn: "${hostname}.${domain}"

runcmd: 
 - echo "127.0.0.1 ${hostname} ${hostname}.${domain} >> /etc/hosts"
 - snap install --classic aws-cli
 - aws s3 cp s3://maximumpigs-various/splunk.deb /opt/splunk.deb
 - aws s3 cp s3://maximumpigs-various/Splunk.License /opt/splunk.license
 - aws s3 cp s3://maximumpigs-various/index_and_forward.tgz /opt/index_and_forward.tgz
 - dpkg -i /opt/splunk.deb
 - /opt/splunk/bin/splunk start --accept-license --answer-yes --seed-passwd "Administrator1!"
 - /opt/splunk/bin/splunk enable boot-start
 - rm /opt/splunk.deb